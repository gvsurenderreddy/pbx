[globals]
CONSOLE=Console/dsp				; Console interface for demo
IAXINFO=guest					; IAXtel username/password
TRUNK=DAHDI/G2					; Trunk interface
TRUNKMSD=1					; MSD digits to strip (usually 1 or 0)

[internal]
;hot desking
;exten => _48XXX,1,Answer()
;exten => _48XXX,n,Set(COMID=${ODBC_HDGETCOM(${CALLERID(num)})})
;exten => _48XXX,n,Set(EMPID=${ODBC_HDGETEMP(${EXTEN:2},${COMID})})
;exten => _48XXX,n,Set(PHOID=${ODBC_HDGETPHO(${CALLERID(num)})})
;exten => _48XXX,n,Set(ODBC_HDNULL(${EMPID},${PHOID})=${EMPID})
;exten => _48XXX,n,Set(ODBC_HDUP(${EMPID},${PHOID})=${EMPID})
;exten => _48XXX,n,SayDigits(${EXTEN:2})
;exten => _47XXX,1,Answer()
;exten => _47XXX,n,Set(COMID=${ODBC_HDGETCOM(${CALLERID(num)})})
;exten => _47XXX,n,Set(EMPID=${ODBC_HDGETEMP(${EXTEN:2},${COMID})})
;exten => _47XXX,n,Set(PHOID=${ODBC_HDGETPHO(${CALLERID(num)})})
;exten => _47XXX,n,Set(ODBC_HDNULL(${EMPID},${PHOID})=${EMPID})
;exten => _47XXX,n,SayDigits(${EXTEN:2})


;exten => 99,1,Answer()
;exten => 99,n,VoiceMail(e5ec14a0@mailbox,s)
;exten => 99,n,MP3Player(http://www.tonycuffe.com/mp3/tailtoddle_lo.mp3)


;II
exten => _XXX,1,Set(IIDIAHASH=${CALLERID(num)})
exten => _XXX,n,Set(IICOMID=${ODBC_IIGETCOM(${IIDIAHASH})})
exten => _XXX,n,Set(IIRECHASH=${ODBC_IIGETRECHASH(${EXTEN},${IICOMID})})
exten => _XXX,n,Set(IIDIAPHOID=${ODBC_IIGETDIAPHO(${IIDIAHASH})})
exten => _XXX,n,Set(IIRECEMPID=${ODBC_IIGETRECEMP(${EXTEN},${IICOMID})})
exten => _XXX,n,Set(CALLERID(name)=${ODBC_GETDIAPHONAME(${IIDIAPHOID})})
exten => _XXX,n,Set(CALLERID(num)=${ODBC_GETRECEMPNAME(${IIRECEMPID})})
exten => _XXX,n,Set(CDR(company_id)=${IICOMID})
exten => _XXX,n,Set(CDR(dialer_phone_id)=${IIDIAPHOID})
exten => _XXX,n,Set(CDR(receiver_employee_id)=${IIRECEMPID})
exten => _XXX,n,Set(CDR(rate)=0)
exten => _XXX,n,Set(CDR(dialer)=${ODBC_GETPHONAME(${IIDIAPHOID})})
exten => _XXX,n,Set(CDR(receiver)=${ODBC_GETEMPNAME(${IIRECEMPID})})
exten => _XXX,n,Set(CDR(type)=ii)
exten => _XXX,n,Dial(${ODBC_IIGETSIPS(${IIRECEMPID})})

;IO
exten => _XXXXXX.,1,Set(IODIAHASH=${CALLERID(num)})
;exten => _XXXXXX.,n,Set(IOCOMID=${ODBC_IOGETCOM(${IODIAHASH})})
;exten => _XXXXXX.,n,Set(IOGROUP=${ODBC_IOGETGROUP(${IOCOMID})})
;exten => _XXXXXX.,n,Set(IODIAPHOID=${ODBC_IOGETDIAPHO(${IODIAHASH})})
;exten => _XXXXXX.,n,Set(IODIASUBID=${ODBC_IOGETDIASUB(${EXTEN})})
;exten => _XXXXXX.,n,Set(IORATEID=${ODBC_IOGETRATEID(${EXTEN})})
;exten => _XXXXXX.,n,Set(IORATE=${ODBC_IOGETRATE(${IORATEID})})
;exten => _XXXXXX.,n,Set(IOLINE=${ODBC_IOGETLINE(${IOGROUP},${IORATEID})})
;exten => _XXXXXX.,n,Set(CALLERID(name)=${ODBC_DYNCALLER(${IODIAEMPID})})
;exten => _XXXXXX.,n,Set(CALLERID(num)=${ODBC_DYNNUM(${IODIAEMPID})})
exten => _XXXXXX.,n,Set(CALLERID(num)=${IOGETDID(${EXTEN},${IOCOMID})})
;exten => _XXXXXX.,n,Set(CDR(company_id)=${IOCOMID})
;exten => _XXXXXX.,n,Set(CDR(dialer_phone_id)=${IODIAPHOID})
;exten => _XXXXXX.,n,Set(CDR(rate)=${IORATE})
;exten => _XXXXXX.,n,Set(CDR(dialer)=${ODBC_GETPHONAME(${IODIAPHOID})})
;exten => _XXXXXX.,n,Set(CDR(receiver)=+${EXTEN})
;exten => _XXXXXX.,n,Set(CDR(type)=io)
exten => _XXXXXX.,n,Dial(SIP/${EXTEN}@sip7985080)

exten => _XXXX,1,Set(ARRAY(OICOMID,OIRECSUBID,OIRECSUBNAME,OIRECCOMVMID)=${ODBC_OIGETDATA(${EXTEN})})
exten => _XXXX,n,Set(CALLERID(name)=${OIRECSUBNAME})
exten => _XXXX,n,Set(CDR(receiver_suscription_id)=${OIRECSUBID})
exten => _XXXX,n,Set(CDR(company_id)=${OICOMID})
exten => _XXXX,n,Set(CDR(rate)=1)
exten => _XXXX,n,Set(CDR(dialer)=${CALLERID(number)})
exten => _XXXX,n,Set(CDR(receiver)=${EXTEN})
exten => _XXXX,n,Set(CDR(type)=oi)
exten => _XXXX,n,Set(ARRAY(OISIPSC,OISIPS)=${ODBC_OIGETSIPS(${OIRECSUBID})})
exten => _XXXX,n,ExecIf(${OISIPSC}>0?Dial(${OISIPS},20))
exten => _XXXX,n,System(wget https://s3-ap-southeast-1.amazonaws.com/fortyeight/ging/0b0f6140.mp3 -P /tmp/)
;exten => _XXXX,n,Playback(/tmp/0b0f6140)
exten => _XXXX,n,VoiceMail(${OIRECCOMVMID}@internal,s)
exten => _XXXX,n,Hangup()




[public]

exten => _X.,1,Set(OIEXTEN=${EXTEN})
exten => _X.,n,Set(OICOMID=${ODBC_OIGETCOM(${OIEXTEN})})
exten => _X.,n,GoToIf(${OICOMID}?accepted:notaccepted)
exten => _X.,n(accepted),Set(OIRECSUBID=${ODBC_OIGETRECSUB(${OIEXTEN})})
exten => _X.,n,Set(OIRECRATE=${ODBC_OIGETRECRATE(${OIRECSUBID})})
exten => _X.,n,Set(OIPREFIX=${ODBC_OIGETPREFIX(${OIRECSUBID})})
exten => _X.,n,Set(CALLERID(name)=${OIPREFIX}${CALLERID(name)})
exten => _X.,n,Set(CDR(receiver_suscription_id)=${OIRECSUBID})
exten => _X.,n,Set(CDR(company_id)=${OICOMID})
exten => _X.,n,Set(CDR(rate)=${ODBC_OIGETRECRATE(${OIRECSUBID})})
exten => _X.,n,Set(CDR(dialer)=+${CALLERID(num)})
exten => _X.,n,Set(CDR(receiver)=${ODBC_GETSUBNUM(${OIRECSUBID})})
exten => _X.,n,Set(CDR(type)=oi)
exten => _X.,n,Set(OIDIAL=${ODBC_OIGETSIPSOK(${OIRECSUBID})})
exten => _X.,n,ExecIf(${OIDIAL}>0?Dial(${ODBC_OIGETSIPS(${OIRECSUBID})},20))
exten => _X.,n,Set(OIMB=${ODBC_OIGETVM(${OIRECSUBID})})
exten => _X.,n,Set(OIRECORD=${ODBC_OIGETVMPLAY(${OIRECSUBID})})
exten => _X.,n,Set(OIFILE=${ODBC_OIGETVMFILE(${OIRECSUBID})})
exten => _X.,n,GoToIf(${OIFILE}?annoncement:noannoncement)
exten => _X.,n(annoncement),Answer()
exten => _X.,n,System(wget http://s3-ap-southeast-1.amazonaws.com/fortyeight/ging/${OIFILE}.mp3 -P /tmp/)
exten => _X.,n,Playback(/tmp/${OIFILE})
exten => _X.,n(noannoncement),ExecIf(${OIRECORD}?VoiceMail(${OIMB}@mailbox,s):Hangup())
exten => _X.,n(notaccepted),Hangup()